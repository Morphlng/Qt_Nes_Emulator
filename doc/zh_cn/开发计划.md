# 开发计划

可能根据实际进度改变

## 1、CPU

首先从CPU入手，确保实现一个可靠的CPU（能够正确的执行6502指令）。目前计划仅完成官方指令集（151条），因为仅有很少的游戏使用了扩展指令。可以通过手写一些汇编代码，然后利用[6502 Assembler](https://www.masswerk.at/6502/assembler.html)编译为机器指令进行测试。

## 2、Cartridge

当CPU的编码基本结束时，就应该着手写卡带了。因为NES的输入都是从卡带里读取，然后写入内存，所以一些地址都是远超2KB的地址空间（因为他们在卡带上），我们需要确保地址映射关系正确。

Mapper可以仅实现Mapper0、2，其中Mappper0其实什么都没做，因此就是基本的卡带；而Mapper2仅仅扩充了程序指令块，因此也很容易实现。我们可以在后续逐渐添加更多Mapper。常见的Mapper有：0、1、2、3、66

在nesdev上，有很多大神自己编写的nes测试用例，当我们的模拟器足够健壮时就可以以他们作为测试输入了。

## 3、PPU

PPU应该是整个模拟器编写中最困难的一部分，它的渲染流水很麻烦，而且有很多概念（Nametable、Pattern Table、Sprites...)，我们不需要立刻将其渲染结果输出到屏幕上，可以比对着其他模拟器先看看VRAM的信息。

PPU的画面输出一般可以分为背景、精灵、滚动。我们不需要急着实现滚动，并以一些完全不需要滚动的游戏作为测试，比如说`Donkey Kong`（Mapper0），先检查图案表的排列是否正确，调色板是否正确。

这个时候再加入滚动的功能，这部分比较麻烦，因为你需要精确的定位到一个8*8图案的某一个像素的运动，而且要确保PPU寄存器、PPUADDR和滚动参数的完全正确。当完成滚动后，基本已经大功告成了，你可以加载`Super_mario_brothers`，当你没有操作时它应该会自动进行，是一个检查X轴滚动的好游戏。至于Y轴滚动，可以使用`Ice_Climber`。

## 4、Controller

虽然说理论上我们应该为游戏加入声音，但是实际操作会触发更多的可能，有助于进一步debug，所以我决定先实现控制器。控制器的实现并不困难，我们只需要在用户按下和松开时修改按键的状态，然后具体的执行是游戏需要处理的事情。

## 5、APU

APU这块我没有想到很好的实现方式(因为资料较少)，可能暂且搁置。

## 6、更多

作为扩展，我们可以为模拟器添加更多的Mapper支持。另一方面，加入一些独有的功能也很不错，比如存档/读档、画面缩放、Debugger等等
